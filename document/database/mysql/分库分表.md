### 分库

- 分库理由：单库的并发达到极限，需要分库

### 分表

- 垂直拆分
    - 场景：单表的字段过多，即大表拆分成小表
    - 拆分方式：把一个有很多字段的表给拆分成多个表，或者是多个库 每个库表的结构都不一样，每个库表都包含部分字段
- 水平拆分
    - 场景：单表的数据量过多
    - 拆分方式：把一个表的数据给弄到多个库的多个表里，但每个库的表结构都一样，只不过每个库中表放的数据是不同的，所有库表的数据加起来就是全部数据
    - 将数据均匀放更多的库里，然后用多个库来抗更高的并发，还有就是用多个库的存储容量来进行扩容
    - 拆分逻辑：
        - 按range分（一般按照时间范围分表），较少使用
            - 优点：容易扩容，按照时间范围，隔一段时间创建新的库就行
            - 缺点：因为容易产生热点问题，即某一个范围的数据是热点数据，则流量全部打到一个库上（如订单按照订单ID或者用户ID的范围进行拆分）
            - 使用场景：比如对一些日志数据按照时间段进行增量存储
        - 按某字段hash（如按照用户ID，订单ID），最为常用
            - 优点：数据可以均匀分配到各个库中，不太会产生热点数据，也分散了请求压力
            - 缺点：扩容起来比较麻烦，会有一个数据迁移的过程

### 分库分表中间件

1. Sharding-JDBC（ShardingSphere）
    - ShardingSphere是一个分布式数据库中间件套件，由Sharding-JDBC（核心组件，可单独使用）、Sharding-Proxy和Sharding-Sidecar三个子项目组成
    - 支持分库分表、读写分离、分布式id生成、柔性事务（最大努力送达型事务、TCC事务）、数据脱敏、数据治理等
    - Client层方案，通过拦截和解析SQL语句，将数据划分到不同的数据库实例或表中，实现数据的水平分片和分布式查询。Sharding-JDBC还支持垂直分片和水平分片两种分片模式
    - Client层方案的优点： 不用部署，运维成本低，无需代理层的二次转发请求，性能很高，小型公司适合使用此方案（成本低）
    - 缺点：遇到升级啥的需要各个系统都重新升级版本再发布，各个系统都需要耦合Sharding-JDBC的依赖

2. Mycat（全称为MySQL Cluster Auto Tuning）
    - 支持分库分表、读写分离
    - Proxy层方案的
    - 优点：好处在于对于各个项目是透明的，如果遇到升级只需修改中间件那里
    - 缺点：需要部署，自己及运维一套中间件，运维成本高

   