[阿里面试： 说说强引用、软引用、弱引用、虚引用吧](https://mp.weixin.qq.com/s/VYeB6J8zx6mR8DAQENKIBw)
[面试中经常被问到 Java 引用类型原理，带你深入剖析](https://mp.weixin.qq.com/s/DR5DuFFhbI8CmE9sb7GiDg)
---

### Java 中引入四种引用的目的是让程序自己决定对象的生命周期，JVM 是通过垃圾回收器对这四种引用做不同的处理，来实现对象生命周期的改变

### 四种引用
---

1. 强引用（Strong Reference）
    - 引用方式：Object obj = new Object()
    - 生命周期：当一个对象被强引用变量引用时，它处于可达状态，是不可能被垃圾回收器回收的，即使该对象永远不会被用到也不会被回收 因此强引用有时也是造成 Java 内存泄露的原因之一

---

2. 软引用（Soft Reference）
    - 引用方式：用java.lang.ref.SoftReference 类来实现，可以让对象豁免一些垃圾收集
    - 生命周期：对于软引用关联着的对象，在系统将要发生内存溢出异常之前，将会把这些对象列进回收范围之中并进行第二次回收。如果这次回收还是没有足够的内存，才会抛出内存溢出异常。
      对于只有软引用的对象来说：当系统内存充足时它不会被回收，当系统内存不足时它才会被回收。
    - 使用场景：软引用用来描述一些还有用，但并非必需的对象。软引用通常用在对内存敏感的程序中，比如高速缓存就有用到软引用，内存够用的时候就保留，不够用就回收 Mybatis 缓存类 SoftCache 用到软引用

---

3. 弱引用（Weak Reference）
    - 引用方式：用java.lang.ref.WeakReference类来实现，它比软引用的生存期更短
    - 生命周期：被弱引用关联的对象只能生存到下一次垃圾收集发生之前。当垃圾收集器工作时，无论当前内存是否足够，都会回收掉只被弱引用关联的对象 对于只有弱引用的对象来说，只要垃圾回收机制一运行，不管 JVM
      的内存空间是否足够，都会回收该对象占用的内存
    - 使用场景：弱引用也是用来描述非必需对象的，但是它的强度比软引用更弱一些，如JDK 中的 WeakHashMap ，ThreadLocal中用到弱引用

---

3. 虚引用（Phantom Reference）也称为“幽灵引用”或者“幻影引用”
    - 引用方式：用java.lang.ref.PhantomReference 来实现
    - 生命周期： 如果一个对象仅持有虚引用，那么它就和没有任何引用一样，在任何时候都可能被垃圾回收器回收，它不能单独使用也不能通过它访问对象，虚引用必须和引用队列（RefenenceQueue）联合使用。
      一个对象是否有虚引用的存在，完全不会对其生存时间构成影响，也无法通过虚引用来取得一个对象实例
    - 使用场景：虚引用的主要作用是跟踪对象垃圾回收的状态。仅仅是提供了一种确保对象被 finalize 以后，做某些事情的机制，
      设置虚引用的唯一目的，就是在这个对象被回收器回收的时候收到一个系统通知或者后续添加进一步的处理，DirectByteBuffer中是用虚引用的子类Cleaner.java来实现堆外内存回收的，
      主要作用是在对象被垃圾回收时收到系统通知。虚引用常用于在对象被销毁之前执行一些清理操作

---

### 引用队列

- ReferenceQueue 是用来配合引用工作的，没有ReferenceQueue 一样可以运行。
- SoftReference、WeakReference、PhantomReference 都有一个可以传递 ReferenceQueue 的构造器。
- 创建引用的时候，可以指定关联的队列，当 GC 释放对象内存的时候，会将引用加入到引用队列。如果程序发现某个虚引用已经被加入到引用队列，那么就可以在所引用的对象的内存被回收之前采取必要的行动，这相当于是一种通知机制。
- 当关联的引用队列中有数据的时候，意味着指向的堆内存中的对象被回收。通过这种方式，JVM 允许我们在对象被销毁后，做一些我们自己想做的事情