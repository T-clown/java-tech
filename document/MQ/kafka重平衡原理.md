### 发生重平衡场景

1. 当消费组的消费者发生变化时，如增加或者减少
2. 当topic消息的分区增加时（分区只能增加，不能减少）

- 目的是重新分配分区，实现负载均衡和容错性

### 重平衡流程

1. 消费者组协调器选举

每个消费者组都有一个协调器（coordinator）负责协调重平衡过程。
当消费者组中的协调器不可用（例如崩溃或网络故障）或首次启动时，会触发新的协调器选举过程。
协调器选举使用ZooKeeper或Kafka的内部协调机制进行。

2. 消费者加入消费者组

当一个消费者加入消费者组时，它会向协调器发送加入请求。
加入请求包括消费者的消费者ID、订阅的主题（topics）以及消费者在每个主题上的偏移量等信息。
分区分配策略计算：

协调器接收到消费者加入请求后，开始计算新的分区分配方案。
分配方案计算的算法可以是默认的Round-robin轮询算法，也可以是自定义的范围分配等其他算法。
计算时考虑消费者的订阅信息、已分配的分区、消费者的消费能力等因素。

3. 分区分配方案通知：

协调器计算出新的分区分配方案后，将该方案通知给所有的消费者。
通知中包括了每个消费者被分配到的分区列表。
消费者收到分配方案后，就知道自己需要消费哪些分区了。

4. 消费者重新分配分区并消费消息：

消费者收到分配方案后，根据分配的分区列表，重新分配自己的消费任务。
消费者开始消费分配给自己的分区上的消息。

5. 重平衡完成







