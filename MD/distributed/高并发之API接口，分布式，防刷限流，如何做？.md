[](https://mp.weixin.qq.com/s/70negHg4kNP32l3CrnNRoA)
[谈谈高并发系统的限流](https://mp.weixin.qq.com/s/1ocg-J4W7UiN9T39vw5CNQ)
[](https://mp.weixin.qq.com/s/vyQZvJm5sjnEnrpi1siP2A)
###在开发分布式高并发系统时有三把利器用来保护系统：缓存、降级、限流
    缓存
    缓存的目的是提升系统访问速度和增大系统处理容量
    降级
    降级是当服务出现问题或者影响到核心流程时，需要暂时屏蔽掉，待高峰或者问题解决后再打开
    限流
    限流的目的是通过对并发访问/请求进行限速，或者对一个时间窗口内的请求进行限速来保护系统，一旦达到限制速率则可以拒绝服务、排队或等待、降级等处理

###应用级限流
    一、控制并发数量
        在实际应用中可以通过信号量机制（如Java中的Semaphore）来实现
        Java z并发库 的Semaphore 可以很轻松完成信号量控制，Semaphore可以控制某个资源可被同时访问的个数，通过 acquire() 获取一个许可，如果没有就等待，而 release() 释放一个许可
    二、控制访问速率
        在工程实践中，常见的是使用令牌桶算法来实现这种模式，常用的限流算法有两种：漏桶算法和令牌桶算法。
        1.漏桶算法
        漏桶算法思路很简单，水（请求）先进入到漏桶里，漏桶以一定的速度出水，当水流入速度过大会直接溢出，可以看出漏桶算法能强行限制数据的传输速率
        2.令牌桶算法
        令牌桶算法的原理是系统会以一个恒定的速度往桶里放入令牌，而如果请求需要被处理，则需要先从桶里获取一个令牌，当桶里没有令牌可取时，则拒绝服务，令牌桶算法通过发放令牌，根据令牌的rate频率做请求频率限制，容量限制等
        在我们的工程实践中，通常使用Google开源工具包Guava提供的限流工具类RateLimiter来实现控制速率，该类基于令牌桶算法来完成限流
    三、控制单位时间窗口内请求数
    假设将应用部署到多台机器，应用级限流方式只是单应用内的请求限流，不能进行全局限流。因此我们需要分布式限流和接入层限流来解决这个问题
###分布式限流
    自定义注解+拦截器+Redis实现限流 (单体和分布式均适用，全局限流)
    
###接入层限流
    主要介绍nginx 限流，采用漏桶算法
    限制原理:可一句话概括为：“根据客户端特征，限制其访问频率”，客户端特征主要指IP、UserAgent等。使用IP比UserAgent更可靠，因为IP无法造假，UserAgent可随意伪造。